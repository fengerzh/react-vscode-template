# 部署指南

<cite>
**本文档引用的文件**  
- [vite.config.ts](file://vite.config.ts)
- [package.json](file://package.json)
- [index.html](file://index.html)
- [src/routes/index.tsx](file://src/routes/index.tsx)
- [src/App.tsx](file://src/App.tsx)
- [src/tailwind/postcss.config.js](file://src/tailwind/postcss.config.js)
</cite>

## 目录
1. [构建与输出目录](#构建与输出目录)
2. [静态服务器部署](#静态服务器部署)
3. [CDN与云平台部署](#cdn与云平台部署)
4. [环境变量管理与多环境配置](#环境变量管理与多环境配置)
5. [静态资源缓存策略](#静态资源缓存策略)
6. [History模式路由的服务器配置](#history模式路由的服务器配置)
7. [部署性能优化建议](#部署性能优化建议)

## 构建与输出目录

项目使用 Vite 作为构建工具，构建命令定义在 `package.json` 中，执行 `yarn build` 将生成 `dist` 目录，包含所有静态资源文件（HTML、CSS、JavaScript、图片等），可直接部署到任何静态服务器。

构建过程由 Vite 配置文件 `vite.config.ts` 控制，当前配置中启用了 React 插件和 Ant Design 按需加载插件（`vite-plugin-imp`），确保组件和样式被正确打包和优化。

**Section sources**
- [package.json](file://package.json#L10-L11)
- [vite.config.ts](file://vite.config.ts#L1-L50)

## 静态服务器部署

### Nginx 配置示例

将 `dist` 目录内容复制到 Nginx 的 web 根目录（如 `/usr/share/nginx/html`），并配置 `nginx.conf`：

```nginx
server {
    listen 80;
    server_name your-domain.com;
    root /usr/share/nginx/html;
    index index.html;

    # 处理 History 模式路由
    location / {
        try_files $uri $uri/ /index.html;
    }

    # 静态资源缓存
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

### Apache 配置示例

将 `dist` 目录内容复制到 Apache 的 DocumentRoot，启用 `mod_rewrite` 并创建 `.htaccess` 文件：

```apache
RewriteEngine On
RewriteBase /
RewriteRule ^index\.html$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.html [L]
```

同时可在 `.htaccess` 中设置缓存头：

```apache
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType application/javascript "access plus 1 year"
    ExpiresByType text/css "access plus 1 year"
    ExpiresByType image/* "access plus 1 year"
</IfModule>
```

**Section sources**
- [index.html](file://index.html#L0-L13)

## CDN与云平台部署

### Vercel 部署

1. 将项目推送到 GitHub 仓库
2. 登录 Vercel，导入项目
3. 配置构建命令为 `yarn build`，输出目录为 `dist`
4. 部署完成，Vercel 自动处理静态资源托管和 CDN 分发

### Netlify 部署

1. 将项目推送到 Git 仓库
2. 登录 Netlify，选择 "New site from Git"
3. 配置构建命令 `yarn build`，发布目录 `dist`
4. Netlify 提供免费的 HTTPS 和全球 CDN 加速

**Section sources**
- [package.json](file://package.json#L10-L11)

## 环境变量管理与多环境配置

Vite 支持通过 `.env` 文件管理环境变量。在项目根目录创建以下文件：

- `.env`：所有环境共用
- `.env.development`：开发环境
- `.env.production`：生产环境
- `.env.staging`：预发布环境

在 `vite.config.ts` 中可通过 `process.env` 访问这些变量。例如：

```ts
export default defineConfig({
  define: {
    'import.meta.env.VITE_API_URL': JSON.stringify(process.env.VITE_API_URL)
  }
})
```

在代码中使用：

```ts
const apiUrl = import.meta.env.VITE_API_URL;
```

不同环境构建时，Vite 会自动加载对应的 `.env` 文件。

**Section sources**
- [vite.config.ts](file://vite.config.ts#L1-L50)

## 静态资源缓存策略

为优化性能，建议对静态资源设置长期缓存，并通过文件名哈希实现版本控制。Vite 默认在构建时为 CSS 和 JavaScript 文件名添加内容哈希，确保资源更新后浏览器能获取最新版本。

推荐的 `Cache-Control` 头设置：

- **JS/CSS/字体/图片等静态资源**：`public, max-age=31536000, immutable`
- **HTML 文件**：`no-cache` 或 `max-age=0`，确保用户始终获取最新页面

`immutable` 指示浏览器资源永远不会改变，可安全缓存。

**Section sources**
- [vite.config.ts](file://vite.config.ts#L1-L50)

## History模式路由的服务器配置

项目使用 `react-router-dom` 的 `BrowserRouter`，即 History 模式。此模式下 URL 美观但需要服务器支持：当用户直接访问 `/dashboard/home` 时，服务器需返回 `index.html`，由前端路由接管。

### 服务器配置要求

- **Nginx/Apache**：如上所述，使用 `try_files` 或 `RewriteRule` 将所有非文件请求重定向到 `index.html`
- **CDN/云平台**：Vercel 和 Netlify 默认支持 SPA 重写规则，无需额外配置

在 `src/App.tsx` 中已使用 `BrowserRouter`，确保路由正常工作。

**Section sources**
- [src/App.tsx](file://src/App.tsx#L0-L24)
- [src/routes/index.tsx](file://src/routes/index.tsx#L1-L127)

## 部署性能优化建议

### Gzip 压缩

在 Nginx 中启用 Gzip：

```nginx
gzip on;
gzip_types text/plain text/css application/json application/javascript text/xml application/xml;
```

### 资源预加载

Vite 默认生成的 `index.html` 已包含关键资源的 `<link rel="modulepreload">`，无需额外配置。

### 图片优化

使用 WebP 格式图片，并通过 `<picture>` 标签提供降级方案。项目中图片资源位于 `src/assets`，构建时会被优化。

### 代码分割

Vite 基于 Rollup，自动进行代码分割。路由级懒加载已在 `common-router.tsx` 等文件中通过 `lazy` 实现，确保按需加载。

### Tree Shaking

项目使用 ES 模块语法，Vite 会自动进行 Tree Shaking，移除未使用的代码。

**Section sources**
- [vite.config.ts](file://vite.config.ts#L1-L50)
- [src/routes/common-router.tsx](file://src/routes/common-router.tsx#L0-L53)
- [src/tailwind/postcss.config.js](file://src/tailwind/postcss.config.js#L0-L16)